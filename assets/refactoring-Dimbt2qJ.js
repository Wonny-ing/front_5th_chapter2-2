var A=Object.defineProperty;var E=(e,n,s)=>n in e?A(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var C=(e,n,s)=>E(e,typeof n!="symbol"?n+"":n,s);import{j as t,r as x,c as F,R as M}from"./client-DD4c7S6m.js";const V=e=>e.product.discounts.reduce((n,s)=>e.quantity>=s.quantity&&s.rate>n?s.rate:n,0),U=e=>e.product.price*e.quantity*(1-V(e)),$=e=>e.reduce((n,s)=>n+U(s),0),R=(e,n)=>{if(!n)return e;let s=e;return n.discountType==="amount"?s=Math.max(0,s-n.discountValue):s*=1-n.discountValue/100,s},L=e=>e.reduce((n,s)=>n+s.product.price*s.quantity,0),O=(e,n)=>{const s=L(e),a=$(e),o=R(a,n),r=s-o;return{totalBeforeDiscount:Math.round(s),totalAfterDiscount:Math.round(o),totalDiscount:Math.round(r)}},y=(e,n,s)=>e.map(a=>{if(a.product.id===n){const o=a.product.stock,r=Math.max(0,Math.min(s,o));return r>0?{...a,quantity:r}:null}return a}).filter(a=>a!==null),B=e=>{const{discounts:n}=e.product,{quantity:s}=e;return Math.max(0,...n.filter(a=>s>=a.quantity).map(a=>a.rate))},Q=(e,n)=>{const s=e.find(a=>a.product.id===n.id);return n.stock-((s==null?void 0:s.quantity)||0)},P=(e,n)=>e.find(s=>s.product.id===n);function h({className:e,children:n,type:s="button",onClick:a,disabled:o,...r}){return t.jsx("button",{className:e,onClick:a,type:s,disabled:o,...r,children:n})}function _(e,n){const[s,a]=x.useState(()=>{try{const o=localStorage.getItem(e);return o?JSON.parse(o):n}catch{return n}});return x.useEffect(()=>{try{localStorage.setItem(e,JSON.stringify(s))}catch(o){console.log(o)}},[e,s]),[s,a]}const J=()=>{const[e,n]=_("cart",[]),[s,a]=x.useState(null),o=c=>{const m=P(e,c.id);return c.stock-((m==null?void 0:m.quantity)||0)};return{cart:e,addToCart:c=>{o(c)<=0||n(p=>{const v=P(p,c.id);return v?y(p,c.id,v.quantity+1):[...p,{product:c,quantity:1}]})},removeFromCart:c=>{n(m=>y(m,c,0))},updateQuantity:(c,m)=>{n(p=>y(p,c,m))},applyCoupon:c=>{a(c)},calculateTotal:()=>O(e,s),selectedCoupon:s}},H=e=>{const[n,s]=x.useState(e);return{coupons:n,addCoupon:o=>{s(r=>[...r,o])}}},W=(e=[])=>{const[n,s]=x.useState(e),a=r=>{s(l=>l.map(u=>u.id===r.id?r:u))},o=r=>{s(l=>[...l,r])};return new class{constructor(){C(this,"products",n);C(this,"updateProduct",a);C(this,"addProduct",o)}}},k=x.createContext(void 0);function z({children:e,initialCoupons:n}){const{coupons:s,addCoupon:a}=H(n);return t.jsx(k.Provider,{value:{coupons:s,addCoupon:a},children:e})}function w(){const e=x.useContext(k);if(e===void 0)throw new Error("useCouponContext는 CouponProvider 내에서만 사용할 수 있습니다.");return e}const S={name:"",code:"",discountType:"percentage",discountValue:0};function G(){const{addCoupon:e}=w(),[n,s]=x.useState(S);return{newCoupon:n,handleInputChange:(r,l)=>{s({...n,[r]:l})},handleAddCoupon:()=>{e(n),s(S)}}}const K=(e,n)=>({...e,discounts:[...e.discounts,n]}),X=e=>e.quantity>0&&e.rate>0,Y=(e,n)=>({...e,discounts:e.discounts.filter((s,a)=>a!==n)});function Z({product:e,updateProduct:n,onDiscountsUpdate:s}){const[a,o]=x.useState({quantity:0,rate:0});return{newDiscount:a,handleNewDiscountChange:(d,i)=>{o(c=>({...c,[d]:i}))},handleAddDiscount:()=>{if(!X(a))return;const d=[...e.discounts,a],i=K(e,a);n(i),s(d),o({quantity:0,rate:0})},handleRemoveDiscount:d=>{const i=e.discounts.filter((m,p)=>p!==d),c=Y(e,d);s(i),n(c)}}}const T=x.createContext(void 0);function ee({children:e,initialProducts:n}){const{products:s,updateProduct:a,addProduct:o}=W(n);return t.jsx(T.Provider,{value:{products:s,updateProduct:a,addProduct:o},children:e})}function N(){const e=x.useContext(T);if(e===void 0)throw new Error("useProductContext는 ProductProvider 내에서만 사용할 수 있습니다.");return e}const D={name:"",price:0,stock:0,discounts:[]};function te(e){const{addProduct:n}=N(),[s,a]=x.useState(D);return{newProduct:s,handleInputChange:(l,u)=>{a({...s,[l]:u})},handleAddNewProduct:()=>{const l={...s,id:Date.now().toString()};n(l),a(D),e(!1)}}}function ne({product:e,updateProduct:n,onEditComplete:s}){const[a,o]=x.useState(e);return{editingProduct:a,handleProductNameUpdate:c=>{o(m=>({...m,name:c}))},handlePriceUpdate:c=>{o(m=>({...m,price:c}))},handleStockUpdate:c=>{o(m=>({...m,stock:c}))},handleDiscountUpdate:c=>{o(m=>({...m,discounts:c}))},handleSaveChanges:()=>{n(a),s()}}}const I=x.createContext(void 0);function se({children:e}){const{cart:n,addToCart:s,removeFromCart:a,updateQuantity:o,applyCoupon:r,calculateTotal:l,selectedCoupon:u}=J();return t.jsx(I.Provider,{value:{cart:n,addToCart:s,removeFromCart:a,updateQuantity:o,applyCoupon:r,calculateTotal:l,selectedCoupon:u},children:e})}function f(){const e=x.useContext(I);if(!e)throw new Error("useCartContext는 CartProvider 내에서만 사용할 수 있습니다.");return e}function j(e){return`${(e*100).toFixed(0)}%`}function ae({item:e}){const{removeFromCart:n,updateQuantity:s}=f(),a=B(e);return t.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:e.product.name}),t.jsx("br",{}),t.jsxs("span",{className:"text-sm text-gray-600",children:[e.product.price,"원 x ",e.quantity,a>0&&t.jsxs("span",{className:"text-green-600 ml-1",children:["(",j(a)," 할인 적용)"]})]})]}),t.jsxs("div",{children:[t.jsx(h,{onClick:()=>s(e.product.id,e.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),t.jsx(h,{onClick:()=>s(e.product.id,e.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),t.jsx(h,{onClick:()=>n(e.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]})}function q({options:e,value:n="",onChange:s,className:a="w-full p-2 border rounded",placeholder:o,disabled:r=!1,required:l=!1,name:u,id:d}){const i=c=>{if(s){const m=c.target.value,p=e.find(v=>v.value===m);s(c,p==null?void 0:p.data)}};return t.jsxs("select",{id:d,name:u,value:n,onChange:i,className:a,disabled:r,required:l,children:[o&&t.jsx("option",{value:"",children:o}),e.map(c=>t.jsx("option",{value:c.value,children:c.label},c.value))]})}function oe(){const{coupons:e}=w(),{applyCoupon:n,selectedCoupon:s}=f(),a=e.map((r,l)=>({label:`${r.name} - ${r.discountType==="amount"?`${r.discountValue}원`:`${r.discountValue}%`}`,value:l.toString(),data:r})),o=s?e.findIndex(r=>r.code===s.code).toString():"";return t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),t.jsx(q,{options:a,value:o,onChange:r=>n(e[parseInt(r.target.value)]),placeholder:"쿠폰 선택",className:"w-full p-2 border rounded mb-2"}),s&&t.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인)"]})]})}function re(){const{calculateTotal:e}=f(),{totalBeforeDiscount:n,totalAfterDiscount:s,totalDiscount:a}=e();return t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{children:["상품 금액: ",n.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-green-600",children:["할인 금액: ",a.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",s.toLocaleString(),"원"]})]})]})}const ce=e=>e.discounts.reduce((n,s)=>Math.max(n,s.rate),0);function de({product:e,cart:n}){const{addToCart:s}=f(),a=Q(n,e);return t.jsxs("div",{"data-testid":`product-${e.id}`,className:"bg-white p-3 rounded shadow",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"font-semibold",children:e.name}),t.jsxs("span",{className:"text-gray-600",children:[e.price.toLocaleString(),"원"]})]}),t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[t.jsxs("span",{className:`font-medium ${a>0?"text-green-600":"text-red-600"}`,children:["재고: ",a,"개"]}),e.discounts.length>0&&t.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",j(ce(e))," 할인"]})]}),e.discounts.length>0&&t.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:e.discounts.map((o,r)=>t.jsxs("li",{children:[o.quantity,"개 이상: ",j(o.rate)," 할인"]},r))}),t.jsx(h,{onClick:()=>s(e),className:`w-full px-3 py-1 rounded ${a>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:a<=0,children:a>0?"장바구니에 추가":"품절"})]})}function le({cart:e}){const{products:n}=N();return t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),t.jsx("div",{className:"space-y-2",children:n.map(s=>t.jsx(de,{product:s,cart:e},s.id))})]})}const ue=()=>{const{cart:e}=f();return t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(le,{cart:e}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),t.jsx("div",{className:"space-y-2",children:e.map(n=>t.jsx(ae,{item:n},n.product.id))}),t.jsx(oe,{}),t.jsx(re,{})]})]})]})};var b=(e=>(e.Text="text",e.Number="number",e))(b||{});function g({id:e,label:n="",labelClassName:s,className:a,type:o="text",placeholder:r="",value:l,onChange:u,...d}){return t.jsxs(t.Fragment,{children:[n?t.jsx("label",{htmlFor:e,className:s,children:n}):null,t.jsx("input",{id:e,className:a,onChange:u,placeholder:r,type:o,value:l,...d})]})}function ie(){const{newCoupon:e,handleInputChange:n,handleAddCoupon:s}=G(),a=[{label:"금액(원)",value:"amount"},{label:"할인율(%)",value:"percentage"}];return t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsx(g,{placeholder:"쿠폰 이름",value:e.name,onChange:o=>n("name",o.target.value),className:"w-full p-2 border rounded"}),t.jsx(g,{placeholder:"쿠폰 코드",value:e.code,onChange:o=>n("code",o.target.value),className:"w-full p-2 border rounded"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(q,{options:a,value:e.discountType,onChange:o=>n("discountType",o.target.value)}),t.jsx(g,{type:b.Number,placeholder:"할인 값",value:e.discountValue,onChange:o=>n("discountValue",parseInt(o.target.value)),className:"w-full p-2 border rounded"})]}),t.jsx(h,{onClick:s,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]})}function me(){const{coupons:e}=w();return t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),t.jsx("div",{className:"space-y-2",children:e.map((n,s)=>t.jsxs("div",{"data-testid":`coupon-${s+1}`,className:"bg-gray-100 p-2 rounded",children:[n.name," (",n.code,"):",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`," 할인"]},s))})]})}function xe(){return t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),t.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[t.jsx(ie,{}),t.jsx(me,{})]})]})}function he({setShowNewProductForm:e}){const{newProduct:n,handleInputChange:s,handleAddNewProduct:a}=te(e);return t.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),t.jsx("div",{className:"mb-2",children:t.jsx(g,{label:"상품명",labelClassName:"block text-sm font-medium text-gray-700",id:"productName",type:b.Text,value:n.name,onChange:o=>s("name",o.target.value),className:"w-full p-2 border rounded"})}),t.jsx("div",{className:"mb-2",children:t.jsx(g,{label:"가격",labelClassName:"block text-sm font-medium text-gray-700",id:"productPrice",type:b.Number,value:n.price,onChange:o=>s("price",parseInt(o.target.value)),className:"w-full p-2 border rounded"})}),t.jsx("div",{className:"mb-2",children:t.jsx(g,{id:"productStock",type:b.Number,label:"재고",labelClassName:"block text-sm font-medium text-gray-700",value:n.stock,onChange:o=>s("stock",parseInt(o.target.value)),className:"w-full p-2 border rounded"})}),t.jsx(h,{onClick:a,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})}function pe({product:e,onEdit:n}){return t.jsxs("div",{children:[e.discounts.map((s,a)=>t.jsx("div",{className:"mb-2",children:t.jsxs("span",{children:[s.quantity,"개 이상 구매 시: ",j(s.rate)," 할인"]})},a)),t.jsx(h,{"data-testid":"modify-button",onClick:n,className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})}function ge({product:e,onDiscountsUpdate:n}){const{updateProduct:s}=N(),{newDiscount:a,handleNewDiscountChange:o,handleAddDiscount:r,handleRemoveDiscount:l}=Z({product:e,updateProduct:s,onDiscountsUpdate:n});return t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),e.discounts.map((u,d)=>t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[u.quantity,"개 이상 구매 시 ",j(u.rate)," 할인"]}),t.jsx(h,{onClick:()=>l(d),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},d)),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(g,{type:b.Number,placeholder:"수량",value:a.quantity,onChange:u=>o("quantity",parseInt(u.target.value)),className:"w-1/3 p-2 border rounded"}),t.jsx(g,{type:b.Number,placeholder:"할인율 (%)",value:a.rate*100,onChange:u=>o("rate",parseInt(u.target.value)/100),className:"w-1/3 p-2 border rounded"}),t.jsx(h,{onClick:r,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]})}function be({product:e,onEditComplete:n}){const{updateProduct:s}=N(),{editingProduct:a,handleProductNameUpdate:o,handlePriceUpdate:r,handleStockUpdate:l,handleSaveChanges:u,handleDiscountUpdate:d}=ne({product:e,updateProduct:s,onEditComplete:n});return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"상품명: "}),t.jsx(g,{type:b.Text,value:a.name,onChange:i=>o(i.target.value),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"가격: "}),t.jsx(g,{type:b.Number,value:a.price,onChange:i=>r(parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"재고: "}),t.jsx(g,{type:b.Number,value:a.stock,onChange:i=>l(parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),t.jsx(ge,{product:e,onDiscountsUpdate:d}),t.jsx(h,{onClick:u,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]})}function je({product:e,index:n,isOpen:s,isEditing:a,onToggle:o,onEditStart:r,onEditComplete:l}){return t.jsxs("div",{"data-testid":`product-${n+1}`,className:"bg-white p-4 rounded shadow",children:[t.jsxs(h,{"data-testid":"toggle-button",onClick:o,className:"w-full text-left font-semibold",children:[e.name," - ",e.price,"원 (재고: ",e.stock,")"]}),s&&t.jsx("div",{className:"mt-2",children:a?t.jsx(be,{product:e,onEditComplete:l}):t.jsx(pe,{product:e,onEdit:r})})]})}function Ne(){const{products:e}=N(),[n,s]=x.useState(new Set),[a,o]=x.useState(null),r=d=>{s(i=>{const c=new Set(i);return c.has(d)?c.delete(d):c.add(d),c})},l=d=>{o(d)},u=()=>{o(null)};return t.jsx("div",{className:"space-y-2",children:e.map((d,i)=>t.jsx(je,{product:d,index:i,isOpen:n.has(d.id),isEditing:a===d.id,onToggle:()=>r(d.id),onEditStart:()=>l(d.id),onEditComplete:u},d.id))})}function fe(){const[e,n]=x.useState(!1);return t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),t.jsx(h,{onClick:()=>n(!e),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:e?"취소":"새 상품 추가"}),e&&t.jsx(he,{setShowNewProductForm:n}),t.jsx(Ne,{})]})}const ve=()=>t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(fe,{}),t.jsx(xe,{})]})]});function Ce({isAdmin:e,setIsAdmin:n}){return t.jsx("nav",{className:"bg-blue-600 text-white p-4",children:t.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),t.jsx(h,{className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",onClick:()=>n(!e),children:e?"장바구니 페이지로":"관리자 페이지로"})]})})}const ye=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],we=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],Pe=()=>{const[e,n]=x.useState(!1);return t.jsx(ee,{initialProducts:ye,children:t.jsx(z,{initialCoupons:we,children:t.jsx(se,{children:t.jsxs("div",{className:"min-h-screen bg-gray-100",children:[t.jsx(Ce,{isAdmin:e,setIsAdmin:n}),t.jsx("main",{className:"container mx-auto mt-6",children:e?t.jsx(ve,{}):t.jsx(ue,{})})]})})})})};F.createRoot(document.getElementById("root")).render(t.jsx(M.StrictMode,{children:t.jsx(Pe,{})}));
